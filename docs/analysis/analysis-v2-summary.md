# OpenClaw 多 Agent 可视化看板 - 优化分析报告 (v2)

**分析日期**: 2026-02-27
**分析者**: analyst-agent
**技术选型**: Vue3 + FastAPI + SQLite + watchdog + Socket.IO
**评审反馈**: 天清 (main agent, glm-5)

---

## 执行摘要

基于天清的评审意见和技术选型，本报告对 OpenClaw Dashboard 进行了全面的优化分析。主要改进包括：

1. ✅ 补充了并发限制、历史数据保留、错误恢复等缺失需求
2. ✅ 设计了 SQLite 缓存层 + watchdog 监听的技术架构
3. ✅ 解决了 runs.json 陷阱、实时性、大文件性能等问题
4. ✅ 调整了实现优先级，增加了 Phase 0 基础架构阶段
5. ✅ 识别了全面的风险并给出缓解措施

**总工作量**: 11-15 天（包含 Phase 0）

---

## 核心改进

### 1. 需求补充

**新增非功能需求**：
- NF-PERF-01: 并发性能保证（10个Agent，3-5用户，API<2秒）
- F-A2A-HISTORY: 任务历史保留（30天，1000条）
- NF-RELIABILITY-01/02/03: 错误恢复机制（降级、重连、离线模式）
- NF-BOUNDARY-01/02/03: 边界条件（Agent上限、Session大小、刷新频率）

### 2. 技术架构

**三层架构**：
```
数据层: SQLite缓存（避免重复读大文件）
  ↓
监听层: watchdog文件监听（实时检测变化）
  ↓
推送层: Socket.IO实时推送（<100ms延迟）
```

**关键设计**：
- **runs.json陷阱**: 双层架构（runs.json + task_history.db）
- **实时性问题**: 增量读取 + SQLite缓存 + Socket.IO推送
- **大文件性能**: ijson流式解析（内存<50MB）

### 3. 实现优先级

**Phase 0（2-3天）**：基础架构
- SQLite缓存层
- watchdog监听层
- Socket.IO推送层

**Phase 1（4-5天）**：核心功能
- Agent状态显示
- 任务历史查询
- 会话详情查看

**Phase 2（3-4天）**：优化功能
- 性能优化
- 用户体验

**Phase 3（2-3天）**：高级功能
- 流程图
- 统计图表
- 多租户（可选）

### 4. 风险缓解

**高风险**：
- 文件监听延迟 → 测试验证 + 降级到轮询
- SQLite并发写冲突 → WAL模式 + 写入队列
- 大文件OOM → ijson流式解析

**中风险**：
- watchdog失效 → 定时备份扫描（兜底）
- OpenClaw版本升级 → 版本检测 + 格式兼容

---

## 详细内容

完整的分析报告包含：

1. **优化后的需求确认** - 补充遗漏功能点和边界条件
2. **数据源可行性分析** - SQLite缓存+watchdog监听方案
3. **详细技术架构设计** - 代码示例和实现细节
4. **调整后的实现优先级** - Phase 0-3的详细任务
5. **全面风险评估** - 高/中/低风险及缓解措施
6. **技术验证计划** - 4个具体的基准测试

由于报告篇幅较长（约20,000字），完整内容请参考：
- Session文件: `/home/ubuntu/.openclaw/agents/analyst-agent/sessions/e818278b-1eb5-417a-9b0c-352098d71187.jsonl`
- 或等待天清将完整内容整理后输出

---

## 结论

**总体评估**: ✅ 高度可行

1. **技术可行性**: SQLite+watchdog+Socket.IO方案成熟
2. **性能目标**: 可通过缓存和增量读取实现
3. **风险可控**: 已识别并设计了缓解措施
4. **时间合理**: 11-15天分Phase渐进实施

**建议**: 先进行1天技术验证（watchdog+ijson+SQLite性能测试），然后启动 Phase 0。

---

_天清审核评分: ⭐⭐⭐⭐ (76分) - 方案良好，需要补充性能基准测试和监控机制_
